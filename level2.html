<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Level 2 - Stored XSS</title>
<style>
body { background:#0d0d0d; color:#ff00d4; font-family:Consolas; text-align:center; padding-top:50px; }
textarea, button { background:#111; border:1px solid #ff00d4; color:#ff00d4; padding:8px; }
button { cursor:pointer; font-weight:bold; }
.box { width:60%; min-width:300px; display:inline-block; background:#111; border:1px solid #ff00d4; padding:20px; border-radius:6px; }
.msg { border-bottom:1px dashed #ff00d4; margin-top:10px; padding-bottom:5px; }
.hint { margin-top:10px; opacity:0.8; }
</style>
</head>
<body>

<h1>Level 2 - Stored XSS</h1>

<div class="box">
<p><b>Riddle:</b> Write me down and store me here,<br>
When saved I suddenly appear.<br>
One word makes the system glow â€”<br>
Whisper it inside a popping show.</p><br>

<textarea id="t" rows="3" cols="40"></textarea><br><br>
<button onclick="save()">Save</button>

<h3>Board:</h3>
<div id="board"></div>

<p id="hint" class="hint"></p>
</div>

<script>
let store = [];
let fails = parseInt(localStorage.getItem("lvl2fails") || "0");

function hiddenPayload() {
    const p1 = [60,115,99,114,105,112,116,62];           
    const word = [122,111,104,111];                      
    const p2 = [60,47,115,99,114,105,112,116,62];         
    const prefix = p1.map(c => String.fromCharCode(c)).join("");
    const core = 'alert("' + word.map(c => String.fromCharCode(c)).join("") + '")';
    const suffix = p2.map(c => String.fromCharCode(c)).join("");
    return prefix + core + suffix;
}

function save() {
    const v = document.getElementById("t").value.trim();
    store.push(v);

    if (v === hiddenPayload()) {
        localStorage.removeItem("lvl2fails");
        const pure = v.replace(/<\/?script>/gi, "");
        const script = document.createElement("script");
        script.innerHTML = pure;
        document.body.appendChild(script);
        setTimeout(() => { window.location.href = "level3.html"; }, 800);
    } else {
        fails++;
        localStorage.setItem("lvl2fails", fails.toString());
    }

    render();
}

function render() {
    let out = "";
    store.forEach(s => out += '<p class="msg">' + s + '</p>');
    document.getElementById("board").innerHTML = out;

    if (fails >= 3) {
        document.getElementById("hint").innerText = 'HINT: Use a script wrapper and make something pop.';
    }
}
</script>

</body>
</html>
